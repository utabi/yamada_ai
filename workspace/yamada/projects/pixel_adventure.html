<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Adventure - 8ビット冒険</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        body {
            background: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Press Start 2P', monospace;
            cursor: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAXklEQVQoU2NkYGD4z4AHMP7HpYBx1AAGBgYGxlEDGBgYGBhHDWBgYGBgHDWAgYGBgXHUAAYGBgbGUQMYGBgYGEcNYGBgYGAcNYCBgYGBcdQABgYGBkZcLsLnf3wKAACNBQgBD7EJ0QAAAABJRU5ErkJggg=='), auto;
        }
        
        #game-container {
            background: #1a1a1a;
            border: 8px solid #333;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.3);
            position: relative;
        }
        
        canvas {
            display: block;
            background: #87CEEB;
        }
        
        #ui {
            background: #000;
            color: #fff;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 10px;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        #start-screen h1 {
            font-size: 24px;
            margin-bottom: 30px;
            color: #ffff00;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }
        
        .start-button {
            background: none;
            border: 2px solid #fff;
            color: #fff;
            padding: 10px 20px;
            font-family: 'Press Start 2P', monospace;
            font-size: 12px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }
        
        .start-button:hover {
            background: #fff;
            color: #000;
            transform: scale(1.1);
        }
        
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 30px;
            text-align: center;
            display: none;
            z-index: 200;
        }
        
        #game-over h2 {
            color: #ff0000;
            margin-bottom: 20px;
        }
        
        .pixel-heart {
            color: #ff0000;
            font-size: 16px;
        }
        
        .pixel-coin {
            color: #ffff00;
            font-size: 16px;
        }
        
        #controls {
            position: absolute;
            bottom: -50px;
            left: 0;
            right: 0;
            text-align: center;
            color: #666;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="ui">
            <div class="stat">
                <span class="pixel-heart">♥♥♥</span>
                <span id="health">3</span>
            </div>
            <div class="stat">
                SCORE: <span id="score">0</span>
            </div>
            <div class="stat">
                <span class="pixel-coin">◉</span>
                <span id="coins">0</span>
            </div>
        </div>
        
        <canvas id="game" width="512" height="384"></canvas>
        
        <div id="start-screen">
            <h1>PIXEL ADVENTURE</h1>
            <button class="start-button" onclick="startGame()">START GAME</button>
            <button class="start-button" onclick="startGame('hard')">HARD MODE</button>
            <p style="margin-top: 20px; font-size: 8px;">ARROW KEYS or WASD TO MOVE</p>
            <p style="font-size: 8px;">SPACE TO JUMP</p>
        </div>
        
        <div id="game-over">
            <h2>GAME OVER</h2>
            <p>SCORE: <span id="final-score">0</span></p>
            <p>COINS: <span id="final-coins">0</span></p>
            <button class="start-button" onclick="restartGame()">TRY AGAIN</button>
        </div>
        
        <div id="controls">
            ← → or A D: MOVE | SPACE or W: JUMP | ESC: PAUSE
        </div>
    </div>
    
    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        
        // ゲーム設定
        let gameRunning = false;
        let gameMode = 'normal';
        let score = 0;
        let coins = 0;
        let health = 3;
        
        // プレイヤー
        const player = {
            x: 50,
            y: 200,
            width: 16,
            height: 16,
            vx: 0,
            vy: 0,
            speed: 3,
            jumpPower: 10,
            grounded: false,
            color: '#ff6b6b',
            facing: 1
        };
        
        // ゲームオブジェクト
        let platforms = [];
        let enemies = [];
        let collectibles = [];
        let particles = [];
        
        // 8ビット風の描画関数
        function drawPixelCharacter(x, y, type, frame = 0) {
            ctx.fillStyle = type.color || '#fff';
            
            if (type === 'player') {
                // プレイヤーキャラクター (簡易的な8x8ピクセル)
                const pixels = [
                    [0,0,1,1,1,1,0,0],
                    [0,1,1,1,1,1,1,0],
                    [0,1,0,1,1,0,1,0],
                    [0,1,1,1,1,1,1,0],
                    [0,0,1,1,1,1,0,0],
                    [0,0,1,1,1,1,0,0],
                    [0,0,1,0,0,1,0,0],
                    [0,1,1,0,0,1,1,0]
                ];
                
                ctx.fillStyle = '#ff6b6b';
                for (let py = 0; py < 8; py++) {
                    for (let px = 0; px < 8; px++) {
                        if (pixels[py][px]) {
                            ctx.fillRect(x + px * 2 * player.facing, y + py * 2, 2, 2);
                        }
                    }
                }
            } else if (type === 'enemy') {
                // 敵キャラクター
                ctx.fillStyle = '#9b59b6';
                ctx.fillRect(x, y, 16, 16);
                ctx.fillStyle = '#fff';
                ctx.fillRect(x + 2, y + 2, 4, 4);
                ctx.fillRect(x + 10, y + 2, 4, 4);
                ctx.fillStyle = '#000';
                ctx.fillRect(x + 4, y + 10, 8, 2);
            } else if (type === 'coin') {
                // コイン
                ctx.fillStyle = '#f1c40f';
                ctx.beginPath();
                ctx.arc(x + 8, y + 8, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#f39c12';
                ctx.fillText('$', x + 5, y + 12);
            }
        }
        
        // プラットフォーム生成
        function createPlatforms() {
            platforms = [
                { x: 0, y: 350, width: 512, height: 34 }, // 地面
                { x: 100, y: 280, width: 80, height: 16 },
                { x: 250, y: 220, width: 100, height: 16 },
                { x: 400, y: 260, width: 60, height: 16 },
                { x: 150, y: 150, width: 80, height: 16 }
            ];
        }
        
        // 敵生成
        function createEnemies() {
            enemies = [
                { x: 200, y: 260, width: 16, height: 16, vx: 1, type: 'walker' },
                { x: 350, y: 200, width: 16, height: 16, vx: -1, type: 'walker' },
                { x: 420, y: 240, width: 16, height: 16, vx: 0.5, type: 'walker' }
            ];
            
            if (gameMode === 'hard') {
                enemies.push(
                    { x: 150, y: 130, width: 16, height: 16, vx: 2, type: 'walker' },
                    { x: 300, y: 330, width: 16, height: 16, vx: -2, type: 'walker' }
                );
            }
        }
        
        // コレクタブル生成
        function createCollectibles() {
            collectibles = [
                { x: 120, y: 250, width: 16, height: 16, type: 'coin' },
                { x: 280, y: 190, width: 16, height: 16, type: 'coin' },
                { x: 420, y: 230, width: 16, height: 16, type: 'coin' },
                { x: 180, y: 120, width: 16, height: 16, type: 'coin' },
                { x: 350, y: 320, width: 16, height: 16, type: 'coin' }
            ];
        }
        
        // パーティクル作成
        function createParticle(x, y, type) {
            particles.push({
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 4,
                vy: -Math.random() * 4 - 2,
                life: 30,
                color: type === 'coin' ? '#f1c40f' : '#ff6b6b'
            });
        }
        
        // 衝突検出
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }
        
        // ゲーム更新
        function update() {
            if (!gameRunning) return;
            
            // プレイヤー物理
            player.vy += 0.5; // 重力
            player.x += player.vx;
            player.y += player.vy;
            
            // 摩擦
            player.vx *= 0.8;
            
            // プラットフォームとの衝突
            player.grounded = false;
            platforms.forEach(platform => {
                if (checkCollision(player, platform)) {
                    // 上から着地
                    if (player.vy > 0 && player.y < platform.y) {
                        player.y = platform.y - player.height;
                        player.vy = 0;
                        player.grounded = true;
                    }
                }
            });
            
            // 敵の更新
            enemies.forEach((enemy, index) => {
                enemy.x += enemy.vx;
                
                // 端で反転
                if (enemy.x < 0 || enemy.x > canvas.width - enemy.width) {
                    enemy.vx *= -1;
                }
                
                // プレイヤーとの衝突
                if (checkCollision(player, enemy)) {
                    health--;
                    updateUI();
                    
                    // ノックバック
                    player.vx = (player.x - enemy.x) > 0 ? 10 : -10;
                    player.vy = -5;
                    
                    // パーティクル
                    for (let i = 0; i < 5; i++) {
                        createParticle(player.x + player.width/2, player.y + player.height/2, 'damage');
                    }
                    
                    if (health <= 0) {
                        gameOver();
                    }
                }
            });
            
            // コレクタブルの収集
            collectibles = collectibles.filter(item => {
                if (checkCollision(player, item)) {
                    if (item.type === 'coin') {
                        coins++;
                        score += 100;
                        
                        // パーティクル
                        for (let i = 0; i < 8; i++) {
                            createParticle(item.x + item.width/2, item.y + item.height/2, 'coin');
                        }
                    }
                    updateUI();
                    return false;
                }
                return true;
            });
            
            // パーティクル更新
            particles = particles.filter(particle => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.vy += 0.3;
                particle.life--;
                return particle.life > 0;
            });
            
            // 画面端の処理
            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;
            if (player.y > canvas.height) {
                health = 0;
                gameOver();
            }
            
            // スコア増加
            score++;
            if (score % 100 === 0) {
                updateUI();
            }
        }
        
        // 描画
        function draw() {
            // 背景
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 雲
            ctx.fillStyle = '#fff';
            ctx.fillRect(100, 50, 40, 20);
            ctx.fillRect(90, 55, 60, 20);
            ctx.fillRect(300, 80, 50, 20);
            ctx.fillRect(290, 85, 70, 20);
            
            // プラットフォーム
            ctx.fillStyle = '#8b4513';
            platforms.forEach(platform => {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                // 草
                ctx.fillStyle = '#228b22';
                ctx.fillRect(platform.x, platform.y, platform.width, 4);
                ctx.fillStyle = '#8b4513';
            });
            
            // コレクタブル
            collectibles.forEach(item => {
                drawPixelCharacter(item.x, item.y, 'coin');
            });
            
            // 敵
            enemies.forEach(enemy => {
                drawPixelCharacter(enemy.x, enemy.y, 'enemy');
            });
            
            // プレイヤー
            drawPixelCharacter(player.x, player.y, 'player');
            
            // パーティクル
            particles.forEach(particle => {
                ctx.fillStyle = particle.color;
                ctx.fillRect(particle.x, particle.y, 4, 4);
            });
        }
        
        // ゲームループ
        function gameLoop() {
            update();
            draw();
            if (gameRunning) {
                requestAnimationFrame(gameLoop);
            }
        }
        
        // UI更新
        function updateUI() {
            document.getElementById('health').textContent = health;
            document.getElementById('score').textContent = score;
            document.getElementById('coins').textContent = coins;
        }
        
        // ゲーム開始
        function startGame(mode = 'normal') {
            gameMode = mode;
            gameRunning = true;
            score = 0;
            coins = 0;
            health = mode === 'hard' ? 1 : 3;
            
            player.x = 50;
            player.y = 200;
            player.vx = 0;
            player.vy = 0;
            
            createPlatforms();
            createEnemies();
            createCollectibles();
            
            document.getElementById('start-screen').style.display = 'none';
            updateUI();
            gameLoop();
        }
        
        // ゲームオーバー
        function gameOver() {
            gameRunning = false;
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-coins').textContent = coins;
            document.getElementById('game-over').style.display = 'block';
        }
        
        // リスタート
        function restartGame() {
            document.getElementById('game-over').style.display = 'none';
            startGame(gameMode);
        }
        
        // キーボード入力
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if (gameRunning) {
                // 移動
                if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
                    player.vx = -player.speed;
                    player.facing = -1;
                }
                if (keys['ArrowRight'] || keys['d'] || keys['D']) {
                    player.vx = player.speed;
                    player.facing = 1;
                }
                
                // ジャンプ
                if ((keys[' '] || keys['w'] || keys['W'] || keys['ArrowUp']) && player.grounded) {
                    player.vy = -player.jumpPower;
                }
            }
            
            // 一時停止
            if (e.key === 'Escape') {
                gameRunning = !gameRunning;
                if (gameRunning) gameLoop();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
    </script>
</body>
</html>